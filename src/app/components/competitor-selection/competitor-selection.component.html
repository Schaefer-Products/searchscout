<div class="competitor-selection-container">
  <!-- Header -->
  <div class="section-header">
    <h3>Find Your Competitors</h3>
    <p>Discover who you're competing with based on keyword overlap</p>
  </div>

  <!-- Discover Button (if not yet discovered) -->
  <div class="discover-section" *ngIf="!discoveryComplete">
    <button class="btn-discover" (click)="discoverCompetitors()" [disabled]="isDiscovering">
      <span *ngIf="!isDiscovering">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
        Discover Competitors
      </span>
      <span *ngIf="isDiscovering">
        <span class="spinner"></span>
        Discovering...
      </span>
    </button>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="errorMessage && !isDiscovering">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
      />
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Cache Info & Refresh - ADD THIS SECTION -->
  <div class="cache-header" *ngIf="discoveryComplete">
    <div class="cache-info" *ngIf="cacheMetadata">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
        />
      </svg>
      <span>Data from cache ({{ cacheMetadata.ageInDays }} days old)</span>
    </div>
    <div class="cache-info fresh" *ngIf="!cacheMetadata">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
      <span>Fresh data</span>
    </div>
    <button class="btn-refresh" (click)="refreshCompetitors()" [disabled]="isDiscovering">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
        />
      </svg>
      Refresh
    </button>
  </div>

  <!-- Discovered Competitors List -->
  <div class="competitors-list" *ngIf="discoveryComplete && allCompetitors.length > 0">
    <div class="list-header">
      <h4>Select Competitors to Analyze ({{ selectedCount }} selected)</h4>
      <p class="hint">
        Found {{ totalCompetitorsCount }} competitors. Showing {{ displayedCompetitors.length }}. We recommend selecting
        2-5 competitors for the best results.
      </p>
    </div>

    <div class="competitors-grid">
      <div
        *ngFor="let competitor of displayedCompetitors"
        class="competitor-card"
        [class.selected]="isSelected(competitor.domain)"
        [class.manual]="competitor.isManual"
        (click)="toggleCompetitor(competitor.domain)"
      >
        <!-- Selection Checkbox -->
        <div class="checkbox-wrapper">
          <input
            type="checkbox"
            [checked]="isSelected(competitor.domain)"
            (click)="$event.stopPropagation()"
            (change)="toggleCompetitor(competitor.domain)"
          />
        </div>

        <!-- Competitor Info -->
        <div class="competitor-info">
          <div class="domain-name">
            {{ competitor.domain }}
            <span class="badge manual" *ngIf="competitor.isManual">Manual</span>
          </div>

          <div class="metrics" *ngIf="!competitor.isManual">
            <div class="metric">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                />
              </svg>
              <span>{{ competitor.keywordOverlap }} shared keywords</span>
            </div>
            <div class="metric">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
                />
              </svg>
              <span>{{ competitor.totalKeywords | number }} total keywords</span>
            </div>
          </div>

          <div class="manual-note" *ngIf="competitor.isManual">
            <p>Manually added competitor - metrics will be calculated during analysis</p>
          </div>
        </div>

        <!-- Remove Button (for manual competitors) -->
        <button
          *ngIf="competitor.isManual"
          class="btn-remove"
          (click)="removeCompetitor(competitor.domain); $event.stopPropagation()"
          title="Remove competitor"
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
    <div class="load-more-container" *ngIf="hasMoreCompetitors">
      <button class="btn-load-more" (click)="loadMore()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
        Load More Competitors ({{ remainingCount }} remaining)
      </button>
    </div>
  </div>

  <!-- Manual Entry Section -->
  <div class="manual-entry-section" *ngIf="discoveryComplete">
    <h4>Add Competitor Manually</h4>
    <p class="hint">Know a competitor that wasn't discovered? Add them here.</p>

    <form (ngSubmit)="addManualCompetitor()" class="manual-form">
      <div class="input-group">
        <input
          type="text"
          [(ngModel)]="manualDomain"
          name="manualDomain"
          placeholder="competitor-domain.com"
          class="manual-input"
        />
        <button type="submit" class="btn-add">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          Add
        </button>
      </div>

      <div class="manual-error" *ngIf="manualError">
        {{ manualError }}
      </div>
    </form>
  </div>

  <!-- Confirm Button -->
  <div class="actions-section" *ngIf="discoveryComplete">
    <button class="btn-confirm" (click)="confirmSelection()" [disabled]="selectedCount === 0">
      Analyze {{ selectedCount }} Competitor{{ selectedCount !== 1 ? "s" : "" }}
    </button>
  </div>
</div>
